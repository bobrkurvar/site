{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/static/v5catalog.css">
{% endblock %}

{% block content %}
<main class="catalog-panel catalog-panel--collections">
    <div class="collection-layout">

        <section class="products-section">
            <div class="catalog-header">
                <div class="catalog-tabs">
                    <a href="/catalog/{{ category }}/products"
                       class="catalog-tab {% if active_tab == 'products' %}active{% endif %}">
                        Товары
                    </a>

                    <a href="/catalog/{{ category }}/collections"
                       class="catalog-tab {% if active_tab == 'collections' %}active{% endif %}">
                        Коллекции
                    </a>
                </div>
            </div>

            <div class="collection-grid">
                {% for col in collections %}
                <a href="catalog/collections/{{ col.slug }}" class="collection-item-link">
                    <div class="collection-item">
                        <div class="tile-image-container">
                            {% if col.image_path %}
                            <img src="/{{ col.image_path }}" alt="{{ col.name }}" class="tile-image" loading="lazy">
                            {% else %}
                            <div class="no-image">Нет изображения</div>
                            {% endif %}
                        </div>
                        <div class="tile-header">
                            <h3 class="tile-title">{{ col.name }}</h3>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>

            {# ================= ПАГИНАЦИЯ ================= #}
            {% if total_pages > 1 %}
                {% set base_query = [] %}
                {% for k, v in request.query_params.items() %}
                    {% if k != 'page' and v %}
                        {% set _ = base_query.append(k ~ '=' ~ v) %}
                    {% endif %}
                {% endfor %}
                {% set base_query = '&'.join(base_query) %}
                {% set sep = '&' if base_query else '' %}

                <div class="pagination">
                    {# ← Назад #}
                    {% if page > 1 %}
                        <a class="page-btn" href="?{{ base_query }}{{ sep }}page={{ page - 1 }}">« Назад</a>
                    {% endif %}

                    {# ← Номера страниц #}
                    {% for p in range(1, total_pages + 1) %}
                        {% if p == page %}
                            <span class="page-current">{{ p }}</span>
                        {% else %}
                            <a class="page-btn" href="?{{ base_query }}{{ sep }}page={{ p }}">{{ p }}</a>
                        {% endif %}
                    {% endfor %}

                    {# → Вперёд #}
                    {% if page < total_pages %}
                        <a class="page-btn" href="?{{ base_query }}{{ sep }}page={{ page + 1 }}">Вперёд »</a>
                    {% endif %}
                </div>
          {% endif %}



        </section>
    </div>
</main>
{% endblock %}
